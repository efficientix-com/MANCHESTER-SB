<?xml version="1.0"?><!DOCTYPE pdf PUBLIC "-//big.faceless.org//report" "report-1.1.dtd">
<pdf>
    <#setting locale = "es_MX">
    <#setting time_zone= "America/Mexico_City">
    <#--  <#setting number_format=",##0.00">  -->

    <#assign "dataXML" = "">
    <#if custom?has_content>
        <#if custom.dataXML?has_content>
            <#assign dataXML = custom.dataXML>
        </#if>
        <#setting locale=custom.locale>
        <#assign labels = custom.labels>
        <#if custom.certData?has_content>
            <#assign "certData" = custom.certData>
        <#else>
            <#assign "certData" = record>
        </#if>
        <#assign "satCodes" = custom.satcodes>

        <#if custom.multiCurrencyFeature == "true">
            <#assign "currencyCode" = record.currencysymbol>
            <#assign exchangeRate = record.exchangerate?string.number>
        <#else>
            <#assign "currencyCode" = "MXN">
            <#assign exchangeRate = 1>
        </#if>
        <#if custom.oneWorldFeature == "true">
            <#assign customCompanyInfo = record.subsidiary>
        <#else>
            <#assign "customCompanyInfo" = companyinformation>
        </#if>
        <#if customer.isperson == "T">
            <#assign customerName = customer.firstname + ' ' + customer.lastname>
        <#else>
            <#assign "customerName" = customer.companyname>
        </#if>
        <#assign "summary" = custom.summary>
        <#assign "totalAmount" = summary.subtotal - summary.totalDiscount>
        <#assign "companyTaxRegNumber" = custom.companyInfo.rfc>
        <#assign currencySymbolMap = {"USD":"$","CAD":"$","EUR":"€","AED":"د.إ.‏","AFN":"؋","ALL":"Lek","AMD":"դր.","ARS":"$","AUD":"$","AZN":"ман.","BAM":"KM","BDT":"৳","BGN":"лв.","BHD":"د.ب.‏","BIF":"FBu","BND":"$","BOB":"Bs","BRL":"R$","BWP":"P","BYR":"BYR","BZD":"$","CDF":"FrCD","CHF":"CHF","CLP":"$","CNY":"CN¥","COP":"$","CRC":"₡","CVE":"CV$","CZK":"Kč","DJF":"Fdj","DKK":"kr","DOP":"RD$","DZD":"د.ج.‏","EEK":"kr","EGP":"ج.م.‏","ERN":"Nfk","ETB":"Br","GBP":"£","GEL":"GEL","GHS":"GH₵","GNF":"FG","GTQ":"Q","HKD":"$","HNL":"L","HRK":"kn","HUF":"Ft","IDR":"Rp","ILS":"₪","INR":"টকা","IQD":"د.ع.‏","IRR":"﷼","ISK":"kr","JMD":"$","JOD":"د.أ.‏","JPY":"￥","KES":"Ksh","KHR":"៛","KMF":"FC","KRW":"₩","KWD":"د.ك.‏","KZT":"тңг.","LBP":"ل.ل.‏","LKR":"SL Re","LTL":"Lt","LVL":"Ls","LYD":"د.ل.‏","MAD":"د.م.‏","MDL":"MDL","MGA":"MGA","MKD":"MKD","MMK":"K","MOP":"MOP$","MUR":"MURs","MXN":"$","MYR":"RM","MZN":"MTn","NAD":"N$","NGN":"₦","NIO":"C$","NOK":"kr","NPR":"नेरू","NZD":"$","OMR":"ر.ع.‏","PAB":"B/.","PEN":"S/.","PHP":"₱","PKR":"₨","PLN":"zł","PYG":"₲","QAR":"ر.ق.‏","RON":"RON","RSD":"дин.","RUB":"руб.","RWF":"FR","SAR":"ر.س.‏","SDG":"SDG","SEK":"kr","SGD":"$","SOS":"Ssh","SYP":"ل.س.‏","THB":"฿","TND":"د.ت.‏","TOP":"T$","TRY":"TL","TTD":"$","TWD":"NT$","TZS":"TSh","UAH":"₴","UGX":"USh","UYU":"$","UZS":"UZS","VEF":"Bs.F.","VND":"₫","XAF":"FCFA","XOF":"CFA","YER":"ر.ي.‏","ZAR":"R","ZMK":"ZK"}>
        <#function fmtc value>
            <#assign dst =  currencySymbolMap[currencyCode] + value?number?string["0.00"]>
            <#return dst>
        </#function>
    </#if>
    <head>
        <link name="NotoSans" type="font" subtype="truetype" src="${nsfont.NotoSans_Regular}" src-bold="${nsfont.NotoSans_Bold}" src-italic="${nsfont.NotoSans_Italic}" src-bolditalic="${nsfont.NotoSans_BoldItalic}" bytes="2" />
        <#if .locale == "zh_CN">
        <link name="NotoSansCJKsc" type="font" subtype="opentype" src="${nsfont.NotoSansCJKsc_Regular}" src-bold="${nsfont.NotoSansCJKsc_Bold}" bytes="2" />
        <#elseif .locale == "zh_TW">
        <link name="NotoSansCJKtc" type="font" subtype="opentype" src="${nsfont.NotoSansCJKtc_Regular}" src-bold="${nsfont.NotoSansCJKtc_Bold}" bytes="2" />
        <#elseif .locale == "ja_JP">
        <link name="NotoSansCJKjp" type="font" subtype="opentype" src="${nsfont.NotoSansCJKjp_Regular}" src-bold="${nsfont.NotoSansCJKjp_Bold}" bytes="2" />
        <#elseif .locale == "ko_KR">
        <link name="NotoSansCJKkr" type="font" subtype="opentype" src="${nsfont.NotoSansCJKkr_Regular}" src-bold="${nsfont.NotoSansCJKkr_Bold}" bytes="2" />
        <#elseif .locale == "th_TH">
        <link name="NotoSansThai" type="font" subtype="opentype" src="${nsfont.NotoSansThai_Regular}" src-bold="${nsfont.NotoSansThai_Bold}" bytes="2" />
        </#if>
        <macrolist>
            <macro id="nlheader">
                <table class="header" style="width: 100%;">
                    <tr>
                        <#if certData?has_content>
                            <td colspan="6" rowspan="3">
                                <#if record.custbody_efx_fe_logosub?has_content>
                                    <img height="25%" src="${record.custbody_efx_fe_logosub}" style="float: left; margin: 10px" width="25%" />
                                </#if>
                            </td>
                        <#else>
                            <td colspan="6" rowspan="3">
                                <#if record.custbody_efx_fe_logosub?has_content>
                                    <#if subsidiary.logo@url?length != 0>
                                        <img height="25%" src="${subsidiary.logo@url}" style="float: left; margin: 10px" width="25%" />
                                    <#elseif companyInformation.logoUrl?length != 0>
                                        <img height="25%" src="${companyInformation.logoUrl}" style="float: left; margin: 10px" width="25%" />
                                    </#if>
                                </#if>
                            </td>
                        </#if>
                        <td colspan="6" rowspan="3">
                            <#if certData?has_content>
                                <span class="nameandaddress" style="font-size: 9px; width: 40%;" >${record.custbody_efx_fe_dirsubs?upper_case?keep_before("UNDEFINED")}</span>
                                <span class="nameandaddress" style="font-size: 9px; width: 40%;" >${record.subsidiary.custrecord_mx_sat_industry_type?upper_case}</span><br />
                            </#if>
                            <span class="nameandaddress" style="font-size: 9px; width: 40%;" >${subsidiary.mainaddress_text?upper_case}</span><br />
                            <span class="nameandaddress" style="font-size: 9px; width: 40%;" >${subsidiary.custrecord_mx_sat_industry_type?upper_case}</span>
                        </td>
                        <td colspan="2" style="width: 21px;">&nbsp;</td>
                        <td colspan="4" style="font-size: 10px;" align="right">
                            <span style="font-size: 12px;"><strong>NOTA DE CRÉDITO</strong></span><br />
                            <span class="number" style="font-size: 18px;">${record.tranid}</span><br /> <br />
                            Fecha y hora de emisi&oacute;n<br />${record.createdDate}<br />
                        </td>
                    </tr>
                </table>
            </macro>
            <macro id="nlfooter">
                <table class="footer" style="width: 100%;">
                    <tr>
                        <td><barcode codetype="code128" showtext="true" value="${record.tranid}"/></td>
                        <td align="right"><pagenumber/> of <totalpages/></td>
                    </tr>
                </table>
            </macro>
        </macrolist>

        <style type="text/css">
            * {
                <#if .locale == "zh_CN">
                font-family: NotoSans, NotoSansCJKsc, sans-serif;
                <#elseif .locale == "zh_TW">
                font-family: NotoSans, NotoSansCJKtc, sans-serif;
                <#elseif .locale == "ja_JP">
                font-family: NotoSans, NotoSansCJKjp, sans-serif;
                <#elseif .locale == "ko_KR">
                font-family: NotoSans, NotoSansCJKkr, sans-serif;
                <#elseif .locale == "th_TH">
                font-family: NotoSans, NotoSansThai, sans-serif;
                <#else>
                font-family: NotoSans, sans-serif;
                </#if>
            }
            table {
                font-size: 9pt;
                table-layout: fixed;
                border-color: #e3e3e3;
            }
            th {
                font-weight: bold;
                font-size: 8pt;
                vertical-align: middle;
                padding: 5px 6px 3px;
                background-color: #e3e3e3;
                color: #333333;
            }
            td {
                padding: 4px 6px;
            }
            td p { align:left }
            b {
                font-weight: bold;
                color: #000000;
            }
            table.header td {
                padding: 0;
                font-size: 10pt;
            }
            table.footer td {
                padding: 0;
                font-size: 8pt;
            }
            table.itemtable th {
                padding-bottom: 10px;
                padding-top: 10px;
            }
            table.body td {
                padding-top: 2px;
            }
            table.total {
                page-break-inside: avoid;
            }
            tr.totalrow {
                background-color: #e3e3e3;
                line-height: 200%;
            }
            td.totalboxtop {
                font-size: 10pt;
                background-color: #e3e3e3;
            }
            td.addressheader {
                font-size: 10pt;
                padding-top: 6px;
                padding-bottom: 2px;
            }
            td.address {
                padding-top: 0;
            }
            td.totalboxmid {
                font-size: 28pt;
                padding-top: 20px;
                background-color: #e3e3e3;
            }
            span.title {
                font-size: 28pt;
            }
            span.number {
                font-size: 16pt;
            }
            span.itemname {
                font-weight: bold;
                line-height: 150%;
            }
            hr {
                width: 100%;
                color: #333333;
                background-color: #e3e3e3;
                height: 1px;
            }
        </style>
    </head>
    <body header="nlheader" header-height="10%" footer="nlfooter" footer-height="20pt" padding="0.5in 0.5in 0.5in 0.5in" size="Letter">

        <#assign "desglosa_cliente" = record.entity.custentity_efx_cmp_registra_ieps>
        <#assign "tipoGBL" = record.custbody_efx_fe_gbl_type>

        <#assign "desglose_json_body" = record.custbody_efx_fe_tax_json>
        <#if desglose_json_body?has_content>
            <#assign "desglose_body" = desglose_json_body?eval>
            <#assign "desglose_ieps" = desglose_body.rates_ieps>
            <#assign "desglose_iva" = desglose_body.rates_iva>
            <#assign "ieps_total" = desglose_body.ieps_total>
            <#assign "iva_total" = desglose_body.iva_total>
            <#assign "local_total" = desglose_body.local_total>
            <#assign "desglose_ret" = desglose_body.rates_retencion>
            <#assign "desglose_loc" = desglose_body.rates_local>
            <#assign "desglose_total_discount" = desglose_body.descuentoSinImpuesto>
            <#assign "cabecera_total" = desglose_body.total>
            <#assign "cabecera_subtotal" = desglose_body.subtotal>
        <#else>
            <#assign "desglose_body" = {}>
            <#assign "desglose_ieps" = 0>
            <#assign "desglose_iva" = 0>
            <#assign "ieps_total" = 0>
            <#assign "iva_total" = 0>
            <#assign "local_total" = 0>
            <#assign "desglose_ret" = 0>
            <#assign "desglose_loc" = 0>
            <#assign "desglose_total_discount" = 0>
            <#assign "cabecera_total" = 0>
            <#assign "cabecera_subtotal" = 0>
        </#if>


        <#assign "obj_totales_imp"= {}>
        <#assign totaliepsGBL = 0/>
        <#assign totalivaGBL = 0/>
        <#assign totalretGBL = 0/>
        <#assign totallocGBL = 0/>
        <#assign totalivaimp = 0/>
        <#assign totaldiscount = 0/>
        <#assign totaliepsimp = 0/>
        <#if dataXML?has_content>
            <table style="width: 100%; margin-top: 10px;">
                <tr>
                    <td class="body" colspan="14" style="background-color: #e3e3e3; font-size:9px;"><b>Cliente</b></td>
                    <td></td>
                    <td class="body" colspan="14" style="background-color: #e3e3e3; font-size:9px"><b>Lugar de entrega</b></td>
                </tr>
                <tr>
                    <td colspan="14" rowspan="2" style="border: 1px; border-color: #e3e3e3; font-size:9px;">
                        ${dataXML.Receptor.atributos.Nombre}<br/><br/>
                        ${record.billaddress?keep_after("<br />")}<br/><br/>
                        <b>RFC:</b> <#outputformat "XML">${dataXML.Receptor.atributos.Rfc}</#outputformat><br/><br/>
                        ${record.entity.entityid}
                        <#if record.entity.custentity_mx_sat_industry_type?has_content>
                            <br /><br />${record.entity.custentity_mx_sat_industry_type}
                        </#if>

                    </td>
                    <td></td>


                    <td align="left" colspan="14" style="border: 1px; border-color: #e3e3e3; font-size:9px;">${record.shipaddress?keep_after(" />")?upper_case} </td>
                    <#--  <td align="left" colspan="14" style="border: 1px; border-color: #e3e3e3; font-size:9px;">${record.billaddress?keep_after(" />")?upper_case} </td>  -->
                </tr>
            </table>
        <#else>
            <table style="width: 100%; margin-top: 10px;">
                <tr>
                    <td class="body" colspan="14" style="background-color: #e3e3e3; font-size:9px;"><b>Cliente</b></td>
                    <td></td>
                    <td class="body" colspan="14" style="background-color: #e3e3e3; font-size:9px"><b>Lugar de entrega</b></td>
                </tr>
                <tr>
                <#if record.entity.custentity_mx_sat_registered_name?has_content>
                    <td colspan="14" rowspan="2" style="border: 1px; border-color: #e3e3e3; font-size:9px;">
                        <#--  ${record.entity.custentity_mx_sat_registered_name}<br/><br/>  -->
                        ${record.billaddress?keep_before("<br/>")}<br/><br/>
                        <b>RFC:</b> <#outputformat "XML">${record.custbody_mx_customer_rfc?upper_case}</#outputformat><br/><br />
                        ${record.entity.entityid}
                        <#if record.entity.custentity_mx_sat_industry_type?has_content>
                            <br /><br />${record.entity.custentity_mx_sat_industry_type}
                        </#if>
                    </td>
                <#else>
                    <td colspan="14" rowspan="2" style="border: 1px; border-color: #e3e3e3; font-size:9px;">
                        ${record.entity.custentity_tkiio_razon_social}<br/><br/>
                        <b>RFC:</b> <#outputformat "XML">${record.custbody_mx_customer_rfc?upper_case}</#outputformat><br/><br/>
                        ${record.entity.entityid}
                        <#if record.entity.custentity_mx_sat_industry_type?has_content>
                            <br /><br />${record.entity.custentity_mx_sat_industry_type}
                        </#if>
                    </td>
                </#if>
                <td></td>

                <td align="left" colspan="14" style="border: 1px; border-color: #e3e3e3; font-size:9px;">${record.shipaddress?keep_after(" />")?upper_case} </td>
                </tr>
            </table>
        </#if>

        <table class="body" style="width: 100%; margin-top: 10px;">
            <tr>
                <th colspan="4">Términos de crédito</th>
                <th colspan="4">Factura</th>
                <th colspan="4">No. de Pedido</th>
                <th colspan="6">Concepto de devoluci&oacute;n</th>
            </tr>
            <tr>
                <td colspan="4" style="font-size:10px;">${record.entity.terms}</td>
                <td colspan="4" style="font-size:10px;">${record.createdfrom?keep_after("#")}</td>
                <td colspan="4" style="font-size:10px;">${record.otherrefnum}</td>
                <td colspan="6" style="font-size:10px;">${record.custbody_efx_cmp_motivo_devolucion}</td>
            </tr>
        </table>

        <#assign "line_discount"= 0>
    <#assign "importe_discount" = []>
    <#list record.item as item>
        <#assign "tipo_articulo" = item.item?keep_before(" ")>
        <#if tipo_articulo == "Descuento">
            <#assign "importe_discount" = importe_discount+ [item.grossamt]>
        <#else>
            <#assign "importe_discount" = importe_discount + [0]>
        </#if>
    </#list>
    <#assign "importe_discount" = importe_discount+ [0]>
    <#assign "descuento_total" = 0>


    <#if dataXML?has_content>
        <table class="itemtable" style="width: 100%; margin-top: 3px; border: 1px 1px 0px 1px; border-color: #e3e3e3;">
            <#if dataXML.Conceptos.Concepto?is_sequence>
                <thead>
                    <tr style="margin-top: 0px; padding-top: 0px; padding-bottom: 0px">
                        <th align="center" colspan="2"
                            style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Partida
                        </th>
                        <th align="center" colspan="5" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                            SKU
                        </th>
                        <th align="center" colspan="5"
                            style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Código<br/>Clave
                        </th>
                        <th align="center" colspan="5"
                            style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">UPC
                        </th>
                        <th align="center" colspan="18"
                            style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                            <table style="width: 100%; margin-top: 0px; margin-bottom: 0px; border: 1px; border-color: #e3e3e3">
                                <tr>
                                    <th align="center" colspan="18"
                                        style="font-size: 5pt; padding-top: 0px; padding-bottom: 2px; padding-left: 0px; padding-right: 0px;">
                                        Descripción
                                    </th>
                                </tr>
                                <tr>
                                    <td colspan="18" style="border-left: 1px; border-color: #e3e3e3;">
                                        <table style="width: 100%; margin-top: 0px; margin-bottom: 0px;">
                                            <tr>
                                            <td align="left" colspan="4"
                                                style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Base:
                                            </td>
                                            <td align="left" colspan="3"
                                                style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Factor:
                                            </td>
                                            <td align="left" colspan="3"
                                                style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Tasa:
                                            </td>
                                            <td align="left" colspan="4"
                                                style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Importe:
                                            </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </th>

                        <th align="center" colspan="4"
                            style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Cantidad
                        </th>
                        <th align="center" colspan="2"
                            style="font-size: 4pt; padding-left: 0px; padding-right: 0px;">Clave<br/>SAT
                        </th>
                        <th align="center" colspan="2"
                            style="font-size: 4pt; padding-left: 0px; padding-right: 0px;">Unidad
                        </th>
                        <th align="center" colspan="4"
                            style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Precio sin<br/>impuesto
                        </th>
                        <th align="center" colspan="4"
                            style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Importe
                        </th>
                        <th align="center" colspan="4"
                            style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Descuento
                        </th>
                    </tr>
                </thead>
                <#assign partida = 0>
                <#assign skuObj = []>
                <#assign unitsObj = []>
                <#list record.item as item>
                    <#assign tipo_articulo = item.itemtype>
                    <#if tipo_articulo != "Discount">
                        <#assign dato = item.item?keep_after(" : ")>
                        <#assign sku = dato?keep_before(" ")>
                        <#assign skuObj = skuObj + [sku]>

                        <#assign unidad = item.units>
                        <#assign unitsObj = unitsObj + [unidad]>
                    </#if>
                </#list>

                <#assign total_cantidad = 0>
                <#assign lastline = 0>
                <#assign importe_total = 0>
                <#list dataXML.Conceptos.Concepto as Conceptos>
                    <tr>
                        <td align="center" colspan="2" line-height="150%" style="border-left: 0px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px;">${partida+1}
                        </td>
                        <#if partida lt skuObj?size>
                            <td align="center" colspan="5" line-height="150%" style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding:0;">${skuObj[partida]}</td>
                        </#if>
                        <#--  <#list record.item as item>
                        <td align="center" colspan="5" line-height="150%"
                            style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding:0;">${item.item}</td>
                        </#list>  -->
                        <td align="center" colspan="5" line-height="150%"
                            style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding:0;">${Conceptos.atributos.ClaveProdServ}</td>
                        <td align="center" colspan="5"
                            style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.NoIdentificacion}</td>

                        <td colspan="18" style="margin: 0; padding: 0;">
                            <table style="width: 100%">
                                <tr>
                                    <td colspan="18"
                                        style="border-left: 1px; border-color: #e3e3e3; font-size: 6pt; padding-right: 1px; padding-left: 1px; padding-top: 1px; padding-bottom: 0px;">${Conceptos.atributos.Descripcion}</td>
                                </tr>

                                <tr>
                                    <td colspan="18" style="border-left: 1px; border-color: #e3e3e3;">
                                        <table style="width: 100%; margin-top: 0px; margin-bottom: 0px;">
                                            <#if Conceptos.Impuestos.Traslados.Traslado?has_content>
                                                <#if Conceptos.Impuestos.Traslados.Traslado?is_sequence>
                                                        <#list Conceptos.Impuestos.Traslados.Traslado as traslado_imp>
                                                            <tr>
                                                                <td align="left" colspan="4"
                                                                    style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${traslado_imp.atributos.Base?number?string[",##0.00"]}</td>
                                                                <td align="left" colspan="2"
                                                                    style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${traslado_imp.atributos.Impuesto}</td>
                                                                <#assign tasa_line = traslado_imp.atributos.TasaOCuota?number * 100>
                                                                <td align="left" colspan="4"
                                                                    style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${tasa_line?string[",##0.00"]}
                                                                    %
                                                                </td>
                                                                <td align="left" colspan="4"
                                                                    style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${traslado_imp.atributos.Importe?number?string[",##0.00"]}</td>
                                                            </tr>
                                                        </#list>
                                                    <#else>
                                                        <tr>
                                                            <td align="left" colspan="4"
                                                                style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Traslados.Traslado.atributos.Base?number?string[",##0.00"]}</td>
                                                            <td align="left" colspan="2"
                                                                style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Traslados.Traslado.atributos.Impuesto}</td>
                                                            <#assign tasa_line = Conceptos.Impuestos.Traslados.Traslado.atributos.TasaOCuota?number * 100>
                                                            <td align="left" colspan="4"
                                                                style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${tasa_line?string[",##0.00"]}
                                                                %
                                                            </td>
                                                            <td align="left" colspan="4"
                                                                style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Traslados.Traslado.atributos.Importe?number?string[",##0.00"]}</td>
                                                        </tr>
                                                </#if>
                                            </#if>

                                            <#if Conceptos.Impuestos.Retenciones.Retencion?has_content>
                                                <#if Conceptos.Impuestos.Retenciones.Retencion?is_sequence>
                                                    <#list Conceptos.Impuestos.Retenciones.Retencion as ret_imp>
                                                        <tr>
                                                            <td align="left" colspan="4"
                                                                style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${ret_imp.atributos.Base?number?string[",##0.00"]}</td>
                                                            <td align="left" colspan="2"
                                                                style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${ret_imp.atributos.Impuesto}</td>
                                                            <#assign tasa_line = ret_imp.atributos.TasaOCuota?number * 100>
                                                            <td align="left" colspan="4"
                                                                style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${tasa_line?string[",##0.00"]}
                                                                %
                                                            </td>
                                                            <td align="left" colspan="4"
                                                                style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${ret_imp.atributos.Importe?number?string[",##0.00"]}</td>
                                                        </tr>
                                                    </#list>
                                                <#else>
                                                    <tr>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Retenciones.Retencion.atributos.Base?number?string[",##0.00"]}</td>
                                                        <td align="left" colspan="2"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Retenciones.Retencion.atributos.Impuesto}</td>
                                                        <#assign tasa_line = Conceptos.Impuestos.Retenciones.Retencion.atributos.TasaOCuota?number * 100>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${tasa_line?string[",##0.00"]}
                                                            %
                                                        </td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Retenciones.Retencion.atributos.Importe?number?string[",##0.00"]}</td>
                                                    </tr>
                                                </#if>
                                            </#if>
                                        </table>
                                    </td>
                                </tr>
                                <#if Conceptos.InformacionAduanera.NumeroPedimento?has_content>
                                    <tr style="padding:0px 0px;">
                                        <td colspan="6" style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;">
                                            <b>Pedimento:</b></td>
                                        <td colspan="13"
                                            style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;">${Conceptos.InformacionAduanera.NumeroPedimento}</td>
                                    </tr>
                                </#if>

                                <#if Conceptos.atributos.ObjetoImp?has_content>
                                    <tr style="padding:0px 0px;" align="center">
                                        <td colspan="6"
                                            style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;"><b>Objeto de impuesto:</b>
                                        </td>
                                        <#--  <td colspan="13" style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;">${custcol_mx_txn_line_sat_tax_object}</td>  -->
                                        <#if Conceptos.atributos.ObjetoImp?number == 1>
                                            <#assign objImpDesc = "NO OBJETO DE IMPUESTO.">
                                        <#elseif Conceptos.atributos.ObjetoImp?number == 2>
                                            <#assign objImpDesc = "SÍ OBJETO DE IMPUESTO.">
                                        <#elseif Conceptos.atributos.ObjetoImp?number == 3>
                                            <#assign objImpDesc = "SÍ OBJETO DE IMPUESTO Y NO OBLIGATORIO AL DESGLOSE.">
                                        </#if>
                                        <td colspan="13" style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;">${Conceptos.atributos.ObjetoImp} - ${objImpDesc}</td>
                                    </tr>
                                </#if>
                            </table>
                        </td>

                        <td align="center" colspan="4" line-height="150%"
                            style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.Cantidad?number?string[",##0.00"]}</td>
                        <#assign total_cantidad = total_cantidad + Conceptos.atributos.Cantidad?number>
                        <#if partida lt unitsObj?size>
                            <td align="center" colspan="2"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${unitsObj[partida]}</td>
                        </#if>
                        <td align="center" colspan="2"
                            style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.ClaveUnidad}</td>
                        <td align="center" colspan="4"
                            style="border-left: 1px; border-color: #e3e3e3; font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.ValorUnitario?number?string[",##0.00"]}</td>
                        <#assign impuestos_line_calc = 0>
                        <#if Conceptos.Impuestos.Traslados.Traslado?has_content>
                            <#if Conceptos.Impuestos.Traslados.Traslado?is_sequence>
                                <#list Conceptos.Impuestos.Traslados.Traslado as impuestos_linec>
                                    <#assign impuestos_line_calc = impuestos_line_calc + impuestos_linec.atributos.Importe?number>
                                </#list>
                            <#else>
                                <#assign impuestos_line_calc = impuestos_line_calc + Conceptos.Impuestos.Traslados.Traslado.atributos.Importe?number>
                            </#if>
                        </#if>
                        <#if Conceptos.Impuestos.Retenciones.Retencion?has_content>
                            <#if Conceptos.Impuestos.Retenciones.Retencion?is_sequence>
                                <#list Conceptos.Impuestos.Retenciones.Retencion as impuestos_linec>
                                    <#assign impuestos_line_calc = impuestos_line_calc - impuestos_linec.atributos.Importe?number>
                                </#list>
                            <#else>
                                <#assign impuestos_line_calc = impuestos_line_calc - Conceptos.Impuestos.Retenciones.Retencion.atributos.Importe?number>
                            </#if>
                        </#if>
                        <td align="center" colspan="4"
                            style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.Importe?number?string[",##0.00"]}</td>
                        <#assign importe_total = importe_total + Conceptos.atributos.Importe?number>
                        <td align="center" colspan="4"
                            style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.Descuento?number?string[",##0.00"]}</td>
                    </tr>
                    <#assign lastline = lastline+1>

                    <#if dataXML.Conceptos.Concepto?size == lastline>
                        <tr  style="border-top: 1px; border-color: #e3e3e3; font-size: 6pt;">
                            <td align="right" colspan="35">
                                Total de piezas:
                            </td>
                            <td align="center" colspan="4">
                                ${total_cantidad}
                            </td>
                            <td colspan="16">
                                &nbsp;
                            </td>
                        </tr>
                    </#if>
                    <#assign partida = partida+1>
                </#list>
            <#else>
                <thead>
                    <tr style="margin-top: 0px; padding-top: 0px; padding-bottom: 0px">
                        <th align="center" colspan="2" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                            Partida
                        </th>
                        <th align="center" colspan="5" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">SKU
                        </th>
                        <th align="center" colspan="5" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Código<br/>Clave
                        </th>
                        <th align="center" colspan="5" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">UPC
                        </th>
                        <th align="center" colspan="18" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                            <table style="width: 100%; margin-top: 0px; margin-bottom: 0px; border: 1px; border-color: #e3e3e3">
                                <tr>
                                    <th align="center" colspan="18"
                                        style="font-size: 5pt; padding-top: 0px; padding-bottom: 2px; padding-left: 0px; padding-right: 0px;">
                                        Descripción
                                    </th>
                                </tr>
                                <tr>
                                    <td colspan="18" style="border-left: 1px; border-color: #e3e3e3;">
                                        <table style="width: 100%; margin-top: 0px; margin-bottom: 0px;">
                                            <tr>
                                                <td align="left" colspan="4"
                                                    style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Base:
                                                </td>
                                                <td align="left" colspan="3"
                                                    style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Factor:
                                                </td>
                                                <td align="left" colspan="3"
                                                    style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Tasa:
                                                </td>
                                                <td align="left" colspan="4"
                                                    style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Importe:
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </th>

                        <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                            Cantidad
                        </th>
                        <th align="center" colspan="2" style="font-size: 4pt; padding-left: 0px; padding-right: 0px;">
                            Unidad
                        </th>
                        <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Precio
                            sin<br/>impuesto
                        </th>
                        <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                            Importe
                        </th>
                        <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                            Descuento
                        </th>
                    </tr>
                </thead>

                <#assign skuObj = []>
                <#list record.item as item>
                    <#assign dato = item.item?keep_after(": ")>
                    <#assign sku = dato?keep_before(" ")>
                    <#assign skuObj = skuObj + [sku]>

                    <#assign unidad = item.units>
                    <#assign unitsObj = unitsObj + [unidad]>
                </#list>
                <#assign total_cantidad = 0>
                <tr>
                    <td align="center" colspan="2" line-height="150%" style="border-left: 0px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px;">1
                    </td>
                    <td align="center" colspan="5" line-height="150%" style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding:0;">${skuObj[0]}</td>
                    <td align="center" colspan="5" line-height="150%"
                        style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding:0;">${dataXML.Conceptos.Concepto.atributos.ClaveProdServ}</td>
                    <td align="center" colspan="5"
                        style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${dataXML.Conceptos.Concepto.atributos.NoIdentificacion}</td>

                    <td colspan="18" style="margin: 0; padding: 0;">
                        <table style="width: 100%">
                            <tr>
                                <td colspan="18"
                                    style="border-left: 1px; border-color: #e3e3e3; font-size: 6pt; padding-right: 1px; padding-left: 1px; padding-top: 1px; padding-bottom: 0px;">${dataXML.Conceptos.Concepto.atributos.Descripcion}</td>
                            </tr>

                            <tr>
                                <td colspan="18" style="border-left: 1px; border-color: #e3e3e3;">
                                    <table style="width: 100%; margin-top: 0px; margin-bottom: 0px;">
                                        <#if Conceptos.Impuestos.Traslados.Traslado?has_content>
                                            <#if Conceptos.Impuestos.Traslados.Traslado?is_sequence>
                                                <#list Conceptos.Impuestos.Traslados.Traslado as traslado_imp>
                                                    <tr>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${traslado_imp.atributos.Base?number?string[",##0.00"]}</td>
                                                        <td align="left" colspan="2"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${traslado_imp.atributos.Impuesto}</td>
                                                        <#assign tasa_line = traslado_imp.atributos.TasaOCuota?number * 100>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${tasa_line?string[",##0.00"]}
                                                            %
                                                        </td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${traslado_imp.atributos.Importe?number?string[",##0.00"]}</td>
                                                    </tr>
                                                </#list>
                                            <#else>
                                                <tr>
                                                    <td align="left" colspan="4"
                                                        style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Traslados.Traslado.atributos.Base?number?string[",##0.00"]}</td>
                                                    <td align="left" colspan="2"
                                                        style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Traslados.Traslado.atributos.Impuesto}</td>
                                                    <#assign tasa_line = Conceptos.Impuestos.Traslados.Traslado.atributos.TasaOCuota?number * 100>
                                                    <td align="left" colspan="4"
                                                        style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${tasa_line?string[",##0.00"]}
                                                        %
                                                    </td>
                                                    <td align="left" colspan="4"
                                                        style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Traslados.Traslado.atributos.Importe?number?string[",##0.00"]}</td>
                                                </tr>
                                            </#if>
                                        </#if>

                                        <#if Conceptos.Impuestos.Retenciones.Retencion?has_content>
                                            <#if Conceptos.Impuestos.Retenciones.Retencion?is_sequence>
                                                <#list Conceptos.Impuestos.Retenciones.Retencion as ret_imp>
                                                    <tr>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${ret_imp.atributos.Base?number?string[",##0.00"]}</td>
                                                        <td align="left" colspan="2"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${ret_imp.atributos.Impuesto}</td>
                                                        <#assign tasa_line = ret_imp.atributos.TasaOCuota?number * 100>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${tasa_line?string[",##0.00"]}
                                                            %
                                                        </td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${ret_imp.atributos.Importe?number?string[",##0.00"]}</td>
                                                    </tr>
                                                </#list>
                                            <#else>
                                                <tr>
                                                    <td align="left" colspan="4"
                                                        style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Retenciones.Retencion.atributos.Base?number?string[",##0.00"]}</td>
                                                    <td align="left" colspan="2"
                                                        style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Retenciones.Retencion.atributos.Impuesto}</td>
                                                    <#assign tasa_line = Conceptos.Impuestos.Retenciones.Retencion.atributos.TasaOCuota?number * 100>
                                                    <td align="left" colspan="4"
                                                        style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${tasa_line?string[",##0.00"]}
                                                        %
                                                    </td>
                                                    <td align="left" colspan="4"
                                                        style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${Conceptos.Impuestos.Retenciones.Retencion.atributos.Importe?number?string[",##0.00"]}</td>
                                                </tr>
                                            </#if>
                                        </#if>
                                    </table>
                                </td>
                            </tr>
                            <#if dataXML.Conceptos.Concepto.InformacionAduanera.NumeroPedimento?has_content>
                                <tr style="padding:0px 0px;">
                                    <td colspan="6" style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;"><b>Pedimento:</b>
                                    </td>
                                    <td colspan="13"
                                        style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;">${dataXML.Conceptos.Concepto.InformacionAduanera.NumeroPedimento}</td>
                                </tr>
                            </#if>

                            <#if dataXML.Conceptos.Concepto.atributos.ObjetoImp?has_content>
                                <#if dataXML.Conceptos.Concepto.atributos.ObjetoImp?number == 1>
                                    <#assign objImpDesc = "NO OBJETO DE IMPUESTO.">
                                <#elseif dataXML.Conceptos.Concepto.atributos.ObjetoImp?number == 2>
                                    <#assign objImpDesc = "SÍ OBJETO DE IMPUESTO.">
                                <#elseif dataXML.Conceptos.Concepto.atributos.ObjetoImp?number == 3>
                                    <#assign objImpDesc = "SÍ OBJETO DE IMPUESTO Y NO OBLIGATORIO AL DESGLOSE.">
                                </#if>
                                <tr style="padding:0px 0px;">
                                    <td colspan="6"
                                        style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;"><b>Objeto de impuesto:</b>
                                    </td>
                                    <td colspan="13" style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;">${dataXML.Conceptos.Concepto.atributos.ObjetoImp} - ${objImpDesc}</td>
                                </tr>
                            </#if>
                        </table>
                    </td>

                    <td align="center" colspan="4" line-height="150%"
                        style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${dataXML.Conceptos.Concepto.atributos.Cantidad?number?string[",##0.00"]}</td>
                    <#assign total_cantidad = total_cantidad + dataXML.Conceptos.Concepto.atributos.Cantidad?number>
                    <#if partida lt unitsObj?size>
                        <td align="center" colspan="2"
                            style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${unitsObj[partida]}</td>
                    </#if>
                    <td align="center" colspan="2"
                        style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${dataXML.Conceptos.Concepto.atributos.ClaveUnidad}</td>
                    <td align="center" colspan="4"
                        style="border-left: 1px; border-color: #e3e3e3; font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${dataXML.Conceptos.Concepto.atributos.ValorUnitario?number?string[",##0.00"]}</td>
                    <#assign impuestos_line_calc = 0>
                    <#if Conceptos.Impuestos.Traslados.Traslado?has_content>
                        <#if Conceptos.Impuestos.Traslados.Traslado?is_sequence>
                            <#list Conceptos.Impuestos.Traslados.Traslado as impuestos_linec>
                                <#assign impuestos_line_calc = impuestos_line_calc + impuestos_linec.atributos.Importe?number>
                            </#list>
                        <#else>
                            <#assign impuestos_line_calc = impuestos_line_calc + Conceptos.Impuestos.Traslados.Traslado.atributos.Importe?number>
                        </#if>
                    </#if>
                    <#if Conceptos.Impuestos.Retenciones.Retencion?has_content>
                        <#if Conceptos.Impuestos.Retenciones.Retencion?is_sequence>
                            <#list Conceptos.Impuestos.Retenciones.Retencion as impuestos_linec>
                                <#assign impuestos_line_calc = impuestos_line_calc - impuestos_linec.atributos.Importe?number>
                            </#list>
                        <#else>
                            <#assign impuestos_line_calc = impuestos_line_calc - Conceptos.Impuestos.Retenciones.Retencion.atributos.Importe?number>
                        </#if>
                    </#if>

                    <td align="center" colspan="4"
                        style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${dataXML.Conceptos.Concepto.atributos.Importe?number?string[",##0.00"]}</td>
                    <td align="center" colspan="4"
                        style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${dataXML.Conceptos.Concepto.atributos.Descuento?number?string[",##0.00"]}</td>
                </tr>

                <tr  style="border-top: 1px; border-color: #e3e3e3; font-size: 6pt;">
                    <td align="right" colspan="35">
                        Total de piezas:
                    </td>
                    <td align="center" colspan="4">
                        ${total_cantidad}
                    </td>
                    <td colspan="16">
                        &nbsp;
                    </td>
                </tr>
            </#if>
        </table>

    <#else>
        <table class="itemtable" style="width: 100%; margin-top: 3px; border: 1px; border-color: #e3e3e3;">
            <#assign total_cantidad = 0>
            <#assign lastline = 0>
            <#assign importe_total = 0>

            <#assign unitsObj = []>
            <#list record.item as item>
                <#assign tipo_articulo = item.itemtype>
                <#if tipo_articulo != "Discount">
                    <#assign unidad = item.units>
                    <#assign unitsObj = unitsObj + [unidad]>
                </#if>
            </#list>

            <#list record.item as item>
                <#if item_index==0>
                    <thead>
                        <tr style="margin-top: 0px; padding-top: 0px; padding-bottom: 0px">
                            <th align="center" colspan="2" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                                Partida
                            </th>
                            <th align="center" colspan="5" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                                SKU
                            </th>
                            <th align="center" colspan="5" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Código<br/>Clave
                            </th>
                            <th align="center" colspan="5" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">UPC
                            </th>
                            <th align="center" colspan="18" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                                <table style="width: 100%; margin-top: 0px; margin-bottom: 0px; border: 1px; border-color: #e3e3e3">
                                    <tr>
                                        <th align="center" colspan="18"
                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 2px; padding-left: 0px; padding-right: 0px;">
                                            Descripción
                                        </th>
                                    </tr>
                                    <tr>
                                        <td align="left" colspan="4"
                                            style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Base:
                                        </td>
                                        <td align="left" colspan="4"
                                            style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px; margin-top: 0px">
                                            Impuesto:
                                        </td>
                                        <td align="left" colspan="3"
                                            style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Factor:
                                        </td>
                                        <td align="left" colspan="3"
                                            style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Tasa:
                                        </td>
                                        <td align="left" colspan="4"
                                            style="font-size: 4pt; padding-top: 0px; padding-bottom: 0px;">Importe:
                                        </td>
                                    </tr>
                                </table>
                            </th>

                            <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                                Cantidad
                            </th>
                            <th align="center" colspan="2" style="font-size: 4pt; padding-left: 0px; padding-right: 0px;">
                                Clave<br />SAT
                            </th>
                            <th align="center" colspan="2" style="font-size: 4pt; padding-left: 0px; padding-right: 0px;">
                                Unidad
                            </th>
                            <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Precio
                                sin<br/>impuesto
                            </th>
                            <th align="center" colspan="4"
                                style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Importe</th>
                            <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">
                                Descuento
                            </th>
                        </tr>
                    </thead>
                </#if>

                <#assign "tipo_articulo" = item.item?keep_before(" ")>
                <#assign "line_number"= item_index + 1>
                <#if item.quantity?has_content==false>
                    <#assign "line_discount" = line_discount + 1>
                </#if>
                <#assign "line_number"= line_number - line_discount>

                <#if item.quantity?has_content>
                    <tr>

                        <#assign "desglose_json" = item.custcol_efx_fe_tax_json>
                        <#if desglose_json?has_content>
                            <#assign "desglose" = desglose_json?eval>


                            <td align="center" colspan="2" line-height="150%"
                                style="border-left: 0px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px;">${line_number?string["##0"]}</td>
                            <td align="center" colspan="5" line-height="150%"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px;">${item.item?keep_before(" ")}</td>
                            <td align="center" colspan="5" line-height="150%"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding:0;">${item.custcol_mx_txn_line_sat_item_code?keep_before(" ")}</td>
                            <td align="center" colspan="5"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${item.custcol_efx_fe_upc_code}</td>

                            <td colspan="18" style="margin: 0; padding: 0;">
                                <table style="width: 100%">
                                    <tr>
                                        <td colspan="18"
                                            style="border-left: 1px; border-color: #e3e3e3; font-size: 6pt; padding-right: 1px; padding-left: 1px; padding-top: 1px; padding-bottom: 0px;">${item.description}</td>
                                    </tr>

                                    <tr>
                                        <td colspan="18" style="border-left: 1px; border-color: #e3e3e3;">

                                            <table style="width: 100%; margin-top: 0px; margin-bottom: 0px;">

                                                <#if desglose.ieps.name?has_content>
                                                    <tr>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${desglose.ieps.base_importe?number?string[",##0.00"]}</td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${desglose.ieps.name}</td>
                                                        <td align="left" colspan="2"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${desglose.ieps.factor}</td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${desglose.ieps.rate}
                                                            %
                                                        </td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${desglose.ieps.importe?number?string[",##0.00"]}</td>
                                                    </tr>
                                                </#if>

                                                <#if desglose.iva.name?has_content>
                                                    <tr>

                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt; padding-top: 0px; padding-bottom: 0px;">${desglose.iva.base_importe?number?string[",##0.00"]}</td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${desglose.iva.name}</td>
                                                        <td align="left" colspan="2"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${desglose.iva.factor}</td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${desglose.iva.rate}
                                                            %
                                                        </td>
                                                        <td align="left" colspan="4"
                                                            style="font-size: 5pt;padding-top: 0px; padding-bottom: 0px;">${desglose.iva.importe?number?string[",##0.00"]}</td>
                                                    </tr>
                                                </#if>

                                            </table>

                                        </td>
                                    </tr>
                                    <#if item.custcol_mx_txn_line_sat_cust_req_num?has_content>
                                        <tr style="padding:0px 0px;">
                                            <td colspan="6"
                                                style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;"><b>Pedimento:</b>
                                            </td>
                                            <td colspan="13"
                                                style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;">${item.custcol_mx_txn_line_sat_cust_req_num}</td>
                                        </tr>
                                    </#if>

                                    <#if item.custcol_mx_txn_line_sat_tax_object?has_content>
                                        <tr style="padding:0px 0px;">
                                            <td colspan="6"
                                                style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px; border-left: 1px; border-color: #e3e3e3;"><b>Objeto de impuesto:</b>
                                            </td>
                                            <td colspan="13"
                                                style="font-size: 4pt; padding-top: 1px;  padding-bottom: 1px;">${item.custcol_mx_txn_line_sat_tax_object}</td>
                                        </tr>
                                    </#if>

                                </table>
                            </td>


                            <td align="center" colspan="4" line-height="150%"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${item.quantity}</td>
                            <#assign total_cantidad = total_cantidad + item.quantity?number>
                            <td align="center" colspan="2"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">&nbsp;</td>
                            <td align="center" colspan="2"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${item.units}</td>
                            <td align="center" colspan="4"
                                style="border-left: 1px; border-color: #e3e3e3; font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${item.rate?string[",##0.00"]}</td>
                            <td align="center" colspan="4"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${item.amount}</td>
                            <#assign importe_total = importe_total + item.amount>
                            <td align="center" colspan="4"
                                style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">$${importe_discount[item_index+1]?abs}</td>
                                <#--  style="border-left: 1px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">${importe_discount[item_index+1]?number?string[",##0.00"]}</td>  -->
                            <#assign "descuento_total" = descuento_total + importe_discount[item_index+1]>

                        </#if>
                    </tr>
                    <#assign lastline = lastline+1>
                    <#if unitsObj?size == lastline>
                        <tr  style="border-top: 1px; border-color: #e3e3e3; font-size: 6pt;">
                            <td align="right" colspan="35">
                                Total de piezas:
                            </td>
                            <td align="center" colspan="4">
                                ${total_cantidad}
                            </td>
                            <td colspan="16">
                                &nbsp;
                            </td>
                        </tr>
                    </#if>
                </#if>
            </#list>
        </table>
    </#if>

    <table style="width: 100%; margin-top: 5px; padding: 0px; border: 1px; border-color: #e3e3e3;">
        <tr>
            <td colspan="6" style="margin: 0px; padding: 0px;">
                <table class="total" style="width: 100%; margin-top: 0px; border: 0px; border-color: #e3e3e3;">
                    <tr>
                        <td align="left" colspan="3"
                            style="border-top: 0px; border-bottom: 1px; border-color: #e3e3e3; font-size: 7pt;border-right: 0px;">
                            <strong>Cantidad con letra:</strong> ${record.custbody_efx_fe_total_text}</td>
                    </tr>

                    <tr>
                        <td colspan="3" style="font-size: 7pt;border-color: #e3e3e3; border-right: 0px;">
                            <b>Comentarios: </b> ${record.memo?upper_case}</td>
                    </tr>
                </table>
            </td>
            <td colspan="3" style="margin: 0px; padding: 0;">
                <table style="width: 100%; margin-top: 0px; margin-left: 0px; border: 0px; border-color: #e3e3e3;">
                    <tr>
                        <td colspan="1" style="font-size: 7pt; border-color: #e3e3e3;border-left: 1px;  margin-right: 5px;"><b>Importe total</b>
                        </td>
                        <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">$${importe_total?string[",##0.00"]}</td>
                    </tr>
                    <tr>
                        <td colspan="1" style="font-size: 7pt;  border-color: #e3e3e3; border-left: 1px;">
                            <b>Descuento</b></td>
                        <#if dataXML?has_content>
                            <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">$${dataXML.atributos.Descuento?number?string[",##0.00"]}</td>
                        <#else>
                            <#if descuento_total != 0>
                                <td align="left" colspan="1"
                                    style="font-size: 7pt; margin-left: 10px;"><#if desglose_total_discount?has_content>$${desglose_total_discount?number?string[",##0.00"]}</#if></td>
                            <#else>
                                <#if record.discounttotal != 0>
                                    <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">$${record.discounttotal}</td>
                                <#else>
                                    <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">0.00</td>
                                </#if>
                            </#if>
                        </#if>
                    </tr>
                    <tr>
                        <td colspan="1" style="font-size: 7pt; border-color: #e3e3e3;border-left: 1px;  margin-right: 5px;"><b>Subtotal</b>
                        </td>
                        <#if dataXML?has_content>
                            <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">$${(dataXML.atributos.SubTotal?number - dataXML.atributos.Descuento?number)?string[",##0.00"]}</td>
                        <#else>
                            <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">$${record.subtotal?string[",##0.00"]}</td>
                        </#if>
                    </tr>

                    <tr>
                        <td colspan="1" style="font-size: 7pt;  border-color: #e3e3e3;border-left: 1px; margin-right: 5px;"><b>Traslados</b></td>
                        <#if dataXML?has_content>
                            <td align="left" colspan="1"
                                style="font-size: 7pt; margin-left: 10px;">$${dataXML.Impuestos.atributos.TotalImpuestosTrasladados?number?string[",##0.00"]}</td>
                        <#else>
                        <#if desglose_json_body?has_content>
                            <#assign "desglose_body" = desglose_json_body?eval>
                            <#assign "iva_total" = desglose_body.iva_total>
                            <#assign totalivaGBL = iva_total/>
                        </#if>
                            <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">$${totalivaGBL?number?string[",##0.00"]}</td>
                        </#if>
                    </tr>
                    <#if dataXML?has_content>
                        <#if dataXML.Impuestos.Traslados.Traslado?is_sequence>
                            <#list dataXML.Impuestos.Traslados.Traslado as traslados_lista>
                                <#assign iva_ratenum = traslados_lista.atributos.TasaOCuota?number * 100>
                                    <tr>
                                        <td colspan="2" style="font-size: 5pt; border-color: #e3e3e3;border-left: 1px;">
                                            ${iva_ratenum}%: ${traslados_lista.atributos.Importe?number?string[",##0.00"]}<br/>
                                        </td>
                                    </tr>
                            </#list>
                            <#else>
                                <#assign iva_ratenum = dataXML.Impuestos.Traslados.Traslado.atributos.TasaOCuota?number * 100>
                                <tr>
                                    <td colspan="2" style="font-size: 5pt; border-color: #e3e3e3;border-left: 1px;">
                                        ${iva_ratenum}%: ${dataXML.Impuestos.Traslados.Traslado.atributos.Importe?number?string[",##0.00"]}<br/>
                                    </td>
                                </tr>
                        </#if>

                        <#else>
                            <#if desglose_json_body?has_content>
                                <#assign "desglose_body" = desglose_json_body?eval>
                                <#assign "iva_total_desgloses" = desglose_body.rates_iva_data>
                                <#assign obj_totales_imp = iva_total_desgloses/>
                            </#if>
                            <#list obj_totales_imp as Iva_rate, Iva_total>
                                <#assign iva_ratenum = Iva_rate?number>
                                <#assign iva_tasaocuota = iva_ratenum/100>
                                <#if Iva_rate == "16" || Iva_rate == "0">
                                    <tr>
                                        <td colspan="2" style="font-size: 5pt; border-color: #e3e3e3;border-left: 1px;">
                                            ${Iva_rate}%: ${Iva_total?number?string["0.00"]}<br/>
                                        </td>
                                    </tr>
                                </#if>
                            </#list>
                    </#if>

                    <tr>
                        <td colspan="1" style="font-size: 7pt;  border-color: #e3e3e3;border-left: 1px; margin-right: 5px;"><b>Retenciones</b></td>
                        <#if dataXML?has_content>
                            <#if dataXML.Impuestos.atributos.TotalImpuestosRetenidos?has_content>
                                <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">
                                    $${dataXML.Impuestos.atributos.TotalImpuestosRetenidos?number?string[",##0.00"]}
                                </td>
                            <#else>
                                <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">$0.00</td>
                            </#if>
                        <#else>
                            <#if retencion_total?has_content>
                                <td align="left" colspan="1"
                                    style="font-size: 7pt; margin-left: 10px;">$${retencion_total}</td>
                            <#else>
                                <td align="left" colspan="1"
                                    style="font-size: 7pt; margin-left: 10px;">$0.00</td>

                            </#if>
                        </#if>
                    </tr>

                    <tr>
                        <td colspan="1" style="font-size: 7pt;  border-color: #e3e3e3;border-left: 1px; margin-right: 5px;"><b>Total</b>
                        </td>
                        <#if dataXML?has_content>
                            <td align="left" colspan="1" style="font-size: 7pt; margin-left: 10px;">$${dataXML.atributos.Total?number?string[",##0.00"]}</td>
                        <#else>
                            <td align="left" colspan="1"
                                style="font-size: 7pt; margin-left: 10px;"><#if cabecera_total?has_content>$${cabecera_total?number?string[",##0.00"]}</#if></td>
                        </#if>

                    </tr>
                </table>
            </td>
        </tr>
    </table>

        <#if certData?has_content>
            <table class="total" style="width: 100%; margin-top: 10px; border: 1px; border-color: #e3e3e3;">
                <tr>
                    <td style="background-color: #e3e3e3; color: #333333;font-weight: bold;">Información CFDI</td>
                </tr>
                <tr>
                    <td style="border-left: 1px;border-right: 1px; border-color: #e3e3e3;font-size:90%;">
                        <table width="100%">
                            <#if record.recmachcustrecord_mx_rcs_orig_trans?has_content>
                                <tr>
                                    <td colspan="8" style="border-color: #e3e3e3;font-size:90%;"><b>Documentos Relacionados:</b></td>
                                </tr>
                                <#assign obj = relatedOBJ?eval>
                                <tr style="border-left: 1px;border-right: 1px; border-color: #e3e3e3;font-size:90%; padding-left: 12px;font-size: 6pt;">
                                    <td colspan="2" style="font-weight: bold;border-top:1px;border-bottom:1px;border-right:1px;border-left:1px;border-color: #e3e3e3;">Folio</td>
                                    <td colspan="3" style="font-weight: bold;border-top:1px;border-bottom:1px;border-right:1px;border-color: #e3e3e3;">Tipo</td>
                                    <td colspan="3" style="font-weight: bold;border-top:1px;border-bottom:1px;border-right:1px;border-color: #e3e3e3;">UUID</td>
                                </tr>
                                <#list record.recmachcustrecord_mx_rcs_orig_trans as cfdiRelType>
                                    <tr style="border-left: 1px;border-right: 1px; border-color: #e3e3e3;font-size:90%; padding-left: 12px;font-size: 6pt;">
                                        <td colspan="2" style="font-weight: bold;border-bottom:1px;border-right:1px;border-left:1px;border-color: #e3e3e3;">
                                            ${cfdiRelType.custrecord_mx_rcs_rel_cfdi}
                                        </td>
                                        <td colspan="3" style="font-weight: bold;border-bottom:1px;border-right:1px;border-color: #e3e3e3;">
                                            ${cfdiRelType.custrecord_mx_rcs_rel_type}
                                        </td>
                                        <td colspan="3" style="font-weight: bold;border-bottom:1px;border-right:1px;border-color: #e3e3e3;">
                                            ${cfdiRelType.custrecord_mx_rcs_uuid}
                                        </td>
                                    </tr>
                                </#list>
                            </#if>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="border-left: 1px;border-right: 1px; border-color: #e3e3e3;font-size:90%;"><b>UUID</b><br/>${certData.custbody_mx_cfdi_uuid}</td>
                </tr>
                <tr>
                    <td style="border-left: 1px;border-right: 1px; border-color: #e3e3e3;font-size:90%;"><b>Cadena original</b><br/>${certData.custbody_mx_cfdi_cadena_original}</td>
                </tr>
                <tr>
                    <td style="border-left: 1px;border-right: 1px; border-color: #e3e3e3;font-size:90%;"><b>Firma del CFDI</b><br/>${certData.custbody_mx_cfdi_signature}</td>
                </tr>
                <tr>
                    <td style="border-left: 1px;border-right: 1px; border-color: #e3e3e3;font-size:90%;"><b>Firma del SAT</b><br/>${certData.custbody_mx_cfdi_sat_signature}</td>

                </tr>
                <tr>
                    <td style="border-left: 1px;border-right: 1px; border-bottom: 1px; border-color: #e3e3e3;">
                        <table align="left" style="width: 100%; margin-top: 10px;">
                            <tr>
                                <#assign qrcodeImage = "data:image/png;base64, " + certData.custbody_mx_cfdi_qr_code >
                                <td align="center">
                                    <img style="width: 100px;height:100px" src="${qrcodeImage}" />
                                </td>
                            </tr>
                                <tr>
                                    <td align="center"></td>
                                </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </#if>

    </body>
</pdf>